{
  "_format": "hh3-sol-build-info-1",
  "id": "solc-0_8_30-e8b6e6a2cec6bfddae513df4539b80445a261fb1",
  "solcVersion": "0.8.30",
  "solcLongVersion": "0.8.30+commit.73712a01",
  "userSourceNameMap": {
    "contracts/EnergyMarketplace.sol": "project/contracts/EnergyMarketplace.sol"
  },
  "input": {
    "language": "Solidity",
    "settings": {
      "evmVersion": "prague",
      "optimizer": {
        "enabled": true,
        "runs": 200
      },
      "outputSelection": {
        "*": {
          "": [
            "ast"
          ],
          "*": [
            "abi",
            "evm.bytecode",
            "evm.deployedBytecode",
            "evm.methodIdentifiers",
            "metadata"
          ]
        }
      },
      "remappings": []
    },
    "sources": {
      "project/contracts/EnergyMarketplace.sol": {
        "content": "// SPDX-License-Identifier: MIT\npragma solidity 0.8.30;\n\ninterface IEnergyToken {\n    function transferFrom(address from, address to, uint256 amount) external returns (bool);\n    function transfer(address to, uint256 amount) external returns (bool);\n}\n\ninterface IProducerRegistry {\n    function isApprovedProducer(address producer) external view returns (bool);\n}\n\ncontract EnergyMarketplace {\n    struct Listing {\n        address producer;\n        uint256 amount;       \n        uint256 price;\n        bool active;\n    }\n\n    IEnergyToken public token;\n    IProducerRegistry public registry;\n    uint256 public listingCount;\n\n    mapping(uint256 => Listing) public listings;\n\n    event EnergyListed(\n        uint256 indexed listingId,\n        address indexed producer,\n        uint256 amount,\n        uint256 price\n    );\n\n    event EnergyPurchased(\n        uint256 indexed listingId,\n        address indexed buyer,\n        uint256 amount,\n        uint256 totalCost\n    );\n\n    constructor(address registryAddress, address tokenAddress) {\n        registry = IProducerRegistry(registryAddress);\n        token = IEnergyToken(tokenAddress);\n    }\n\n    modifier onlyApprovedProducer() {\n        require(registry.isApprovedProducer(msg.sender), \"Not approved producer\");\n        _;\n    }\n\n    function listEnergy(uint256 _amt, uint256 _price) external onlyApprovedProducer {\n        require(_amt > 0, \"Invalid amount\");\n        require(_price > 0, \"Invalid price\");\n\n        // Producer sends tokens upfront\n        bool ok = token.transferFrom(msg.sender, address(this), _amt);\n        require(ok, \"Token transfer to marketplace failed\");\n\n        listings[listingCount] = Listing({\n            producer: msg.sender,\n            amount: _amt,\n            price: _price,\n            active: true\n        });\n\n        emit EnergyListed(listingCount, msg.sender, _amt, _price);\n\n        listingCount++;\n    }\n\n    function buyEnergy(uint256 listingId, uint256 _amt) external payable {\n        Listing storage ls = listings[listingId];\n\n        require(ls.active, \"Inactive listing\");\n        require(_amt > 0 && _amt <= ls.amount, \"Invalid amount\");\n\n        uint256 cost = _amt * ls.price;\n        require(msg.value == cost, \"Incorrect ETH amount\");\n\n        // Transfer ETH to producer\n        payable(ls.producer).transfer(msg.value);\n\n        // Transfer energy tokens to buyer\n        bool ok = token.transfer(msg.sender, _amt);\n        require(ok, \"Token transfer to buyer failed\");\n\n        // Update listing remaining amount\n        ls.amount -= _amt;\n\n        if (ls.amount == 0) {\n            ls.active = false;\n        }\n        \n        emit EnergyPurchased(listingId, msg.sender, _amt, cost);\n\n    }\n}\n"
      }
    }
  }
}